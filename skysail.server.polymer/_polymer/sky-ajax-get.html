<link rel="import" href="/_polymer/bower_components/polymer/polymer.html">
<link rel="import" href="/_polymer/bower_components/iron-ajax/iron-ajax.html">

<dom-module id="sky-ajax-get">

  <template>
    <iron-ajax 
        id="ajax"
        handle-as="json" 
        headers='{"Accept": "application/json"}'
        on-response="hResponse"
        last-response="{{data}}"
        debounce-duration="300" />
    <div class="list-group">
      <template is="dom-repeat" items="{{data}}">
        <a href="{{renderLink(linkTo, item.id)}}" class="list-group-item" title="{{item.name}}">{{shorten(item.name,linkLength)}}s</a>
      </template>
    </div>
  </template>

  <script>
    Polymer({
      is: 'sky-ajax-get',
      properties: {
    	  url: String,
    	  linkTo: String,
    	  linkLength: {
    		  type: Number,
    		  value: 10
    	  }
      },
      renderLink: function(href, value) {
    	  return href.replace("{id}", value);
    	  return href;
      },
      shorten(str, maxLength) {
    	  if (str.length > maxLength) {
    		  return str.slice(0,maxLength-3) + "...";
    	  }
    	  return str;
      },
      attached: function() {
    	  console.log("hier: " + this.url);
    	  this.$.ajax.url=this.url;
    	  this.$.ajax.generateRequest();
      },
      hResponse: function(request) {
          console.log(request.detail);
      }
    });
  </script>

</dom-module>